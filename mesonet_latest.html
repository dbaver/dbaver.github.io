<!DOCTYPE html>
<html>
<body>

<h2>Using the XMLHttpRequest Object</h2>

<div id="demo">
<table>
  <tr>
    <td colspan="3"><button type="button" onclick="loadXMLDoc()">Change Content</button></td>
  <tr>
    <td>Station ID: </td>
    <td id="std" colspan="2" style="text-align:center">&nbsp</td>
  </tr>
  <tr>
    <td>Latitude: </td>
    <td id="slt">&nbsp</td>
    <td>&nbsp</td>
  </tr>
  <tr>
    <td>Longitude: </td>
    <td id="sln">&nbsp</td>
    <td>&nbsp</td>
  </tr>
  <tr>
    <td>Air Temperature (<sup><small>o</small></sup>F): </td>
    <td id="sat">&nbsp</td>
    <td id="dat">&nbsp</td>
  </tr>
  <tr>
    <td>Relative Humidity (%): </td>
    <td id="srh">&nbsp</td>
    <td id="drh">&nbsp</td>
  </tr>
  <tr>
    <td>Wind Speed (Knots): </td>
    <td id="sws">&nbsp</td>
    <td id="dws">&nbsp</td>
  </tr>
  <tr>
    <td>Air Pressure (mbar): </td>
    <td id="spa">&nbsp</td>
    <td id="dpa">&nbsp</td>
  </tr>
  <tr>
    <td>Cloud Layer: </td>
    <td id="scl">&nbsp</td>
    <td id="dcl">&nbsp</td>
  </tr>
  <tr>
    <td id="dtm" colspan="3" style="text-align:center">&nbsp</td>
  </tr>
</table>
</div>

<script>
var utcOff = "",
    rdgDte = "";
function loadXMLDoc() {
  var url = "https://api.synopticdata.com/v2/stations/",
      dta = "latest?",
      tkn = "token=21b8403530954b0086093a47b496e954",
      sid = "&stid=ksgh",
      vrs = "&vars=air_temp,relative_humidity,wind_speed,wind_gust,pressure,cloud_layer_1",
      uts = "&units=english",
      otz = "&obtimezone=local",
      tft = "&timeformat=%m/%d/%Y%20at%20%H:%M%z";
  url += dta + tkn + sid + vrs + uts + otz + tft;
  let xhttp = new XMLHttpRequest();
  xhttp.open("GET", url);
  xhttp.onload = function() {
    var myObj = JSON.parse(this.responseText),
        id = myObj.STATION[0]["STID"],
        lt = myObj.STATION[0]["LATITUDE"],
        ln = myObj.STATION[0]["LONGITUDE"],
        tad = myObj.STATION[0]["OBSERVATIONS"]["air_temp_value_1"]["date_time"],
        rhd = myObj.STATION[0]["OBSERVATIONS"]["relative_humidity_value_1"]["date_time"],
        wsd = myObj.STATION[0]["OBSERVATIONS"]["wind_speed_value_1"]["date_time"],
        pad = myObj.STATION[0]["OBSERVATIONS"]["pressure_value_1d"]["date_time"],
        cld = myObj.STATION[0]["OBSERVATIONS"]["cloud_layer_1_value_1d"]["date_time"],
        obs = [tad, rhd, wsd, pad, cld],
        latestObs = 0;
    obs.forEach( function(currentValue, index, arr) {
      arr[index] = new Date(parseInt(currentValue.slice(6,10)),parseInt(currentValue.slice(0,2))-1,parseInt(currentValue.slice(3,5)),parseInt(currentValue.slice(14,16)),parseInt(currentValue.slice(17,19)));
      if (arr[index].getTime() > latestObs) {
        latestObs = arr[index].getTime();
        utcOff = ("00" + parseInt(currentValue.slice(20,22))).slice(-2) + "00";
      }
    });

    var d = new Date(latestObs),
        yyyy = d.getFullYear(),
        mm = ("00" + (d.getMonth() + 1)).slice(-2),
        dd = ("00" + d.getDate()).slice(-2);
    rdgDte = mm + "/" + dd + "/" + yyyy;

    std.innerHTML = id;
    slt.innerHTML = lt;
    sln.innerHTML = ln;
    dat.innerHTML = tad;
    sat.innerHTML = myObj.STATION[0]["OBSERVATIONS"]["air_temp_value_1"]["value"];
    drh.innerHTML = rhd;
    srh.innerHTML = myObj.STATION[0]["OBSERVATIONS"]["relative_humidity_value_1"]["value"];
    dws.innerHTML = wsd;
    sws.innerHTML = myObj.STATION[0]["OBSERVATIONS"]["wind_speed_value_1"]["value"];
    dpa.innerHTML = pad;
    spa.innerHTML = myObj.STATION[0]["OBSERVATIONS"]["pressure_value_1d"]["value"];
    dcl.innerHTML = cld;
    scl.innerHTML = myObj.STATION[0]["OBSERVATIONS"]["cloud_layer_1_value_1d"]["value"]["sky_condition"];
    dtm.innerHTML = "Date: " + rdgDte + ", " + "Offset: " + utcOff;
  };
  xhttp.send();
}
</script>

</body>
</html>
