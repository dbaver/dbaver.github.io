<!DOCTYPE html>
<html>
<body>

<h2>Using the XMLHttpRequest Object</h2>

<div id="demo">
<table>
  <tr>
    <td colspan="2"><button type="button" onclick="loadXMLDoc()">Change Content</button></td>
  <tr>
    <td>Station ID: </td>
    <td id="std">&nbsp</td>
  </tr>
  <tr>
    <td>Latitude: </td>
    <td id="slt">&nbsp</td>
  </tr>
  <tr>
    <td>Longitude: </td>
    <td id="sln">&nbsp</td>
  </tr>
  <tr>
    <td>Date/Time: </td>
    <td id="dat">&nbsp</td>
  </tr>
  <tr>
    <td>Air Temperature (<sup><small>o</small></sup>F): </td>
    <td id="sat">&nbsp</td>
  </tr>
  <tr>
    <td>Relative Humidity (%): </td>
    <td id="srh">&nbsp</td>
  </tr>
  <tr>
    <td>Wind Speed (Knots): </td>
    <td id="sws">&nbsp</td>
  </tr>
  <tr>
    <td>Air Pressure (mbar): </td>
    <td id="spa">&nbsp</td>
  </tr>
  <tr>
    <td>Cloud Layer: </td>
    <td id="scl">&nbsp</td>
  </tr>
</table>
</div>

<script>
function loadXMLDoc() {
  var url = "https://api.synopticdata.com/v2/stations/",
      dta = "timeseries?",
      tkn = "token=21b8403530954b0086093a47b496e954",
      sid = "&stid=ksgh",
      dst = "&start=202204281650",
      den = "&end=202204281656",
      vrs = "&vars=air_temp,relative_humidity,wind_speed,wind_gust,pressure,cloud_layer_1",
      uts = "&units=english",
      otz = "&obtimezone=local",
      tft = "&timeformat=%m/%d/%Y%20at%20%H:%M%z";
  url += dta + tkn + sid + dst + den + vrs + uts + otz + tft;
  let xhttp = new XMLHttpRequest();
  xhttp.open("GET", url);
  xhttp.onload = function() {
    var myObj = JSON.parse(this.responseText),
        id = myObj.STATION[0]["STID"],
        lt = myObj.STATION[0]["LATITUDE"],
        ln = myObj.STATION[0]["LONGITUDE"],
        dt = myObj.STATION[0]["OBSERVATIONS"]["date_time"],
        ta = myObj.STATION[0]["OBSERVATIONS"]["air_temp_set_1"],
        rh = myObj.STATION[0]["OBSERVATIONS"]["relative_humidity_set_1"],
        ws = myObj.STATION[0]["OBSERVATIONS"]["wind_speed_set_1"],
        pa = myObj.STATION[0]["OBSERVATIONS"]["pressure_set_1d"],
        cl = myObj.STATION[0]["OBSERVATIONS"]["cloud_layer_1_set_1d"];
    for (let i = 0;i < dt.length; i++) {
      var obs = [ta[i], rh[i], ws[i], pa[i], cl[i]];
      obs.forEach(function(currentValue, index, arr) {
        if (currentValue == null) {
          ta[i] = "---";
          rh[i] = "---";
          ws[i] = "---";
          pa[i] = "---";
          cl[i] = {"sky_condition":"---"};
        }
      });
      if (ta[i]=="---") continue;
      std.innerHTML = id;
      slt.innerHTML = lt;
      sln.innerHTML = ln;
      dat.innerHTML += dt[i] + ", ";
      sat.innerHTML += ta[i] + ", ";
      srh.innerHTML += rh[i] + ", ";
      sws.innerHTML += ws[i] + ", ";
      spa.innerHTML += pa[i] + ", ";
      scl.innerHTML += cl[i]["sky_condition"] + ", ";
    }
    std.innerHTML = id;
    slt.innerHTML = lt;
    sln.innerHTML = ln;
    dat.innerHTML = dat.innerHTML.slice(0,-2);
    sat.innerHTML = sat.innerHTML.slice(0,-2);
    srh.innerHTML = srh.innerHTML.slice(0,-2);
    sws.innerHTML = sws.innerHTML.slice(0,-2);
    spa.innerHTML = spa.innerHTML.slice(0,-2);
    scl.innerHTML = scl.innerHTML.slice(0,-2);
  };
  xhttp.send();
}
</script>

</body>
</html>
